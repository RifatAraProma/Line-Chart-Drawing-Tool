<!DOCTYPE html>
<html>

<head>
  <title>Drawing Tool</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.1.1/svg.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>

  <style>
    #drawing-container {
      border: 1px solid black;
      width: 1000px;
      height: 375px;
    }
  </style>
</head>

<body>
  <div id="drawing-container"></div>
  <button id="saveButton" onclick="saveData()" disabled>Save Data</button>
  <div id="chart"></div>

  <script>
    console.log(screen.width)
    // ... (other code remains unchanged)

    let savedFilesCount = 0; // Counter for saved files

    const saveData = () => {
      document.getElementById('saveButton').disabled = true;

      // Convert the drawing data to JSON
      const jsonData = JSON.stringify(dataToSave, null, 2);

      // Create a new Blob object for the SVG file
      const svgCode = new XMLSerializer().serializeToString(document.getElementById('chartSvg'));
      const svgBlob = new Blob([svgCode], { type: 'image/svg+xml' });

      // Create a new Blob object for the JSON file
      const jsonBlob = new Blob([jsonData], { type: 'application/json' });

      // Create a new Zip Archive
      const zip = new JSZip();
      
      // Generate unique file names using the savedFilesCount
      const svgFileName = `drawing_${savedFilesCount + 1}.svg`;
      const jsonFileName = `drawing_${savedFilesCount + 1}.json`;

      zip.file(svgFileName, svgBlob);
      zip.file(jsonFileName, jsonBlob);

      savedFilesCount++; // Increment the counter

      // Generate the zip file asynchronously
      zip.generateAsync({ type: 'blob' }).then((content) => {
        // Create a temporary URL for the Blob
        const url = URL.createObjectURL(content);

        // Create an anchor element
        const a = document.createElement('a');
        a.href = url;
        a.download = `drawing_data_${savedFilesCount}.zip`; // Use the counter in the filename

        // Programmatically trigger a click event on the anchor element to initiate the download
        a.click();

        // Clean up the temporary URL and remove the anchor element
        URL.revokeObjectURL(url);
        document.body.removeChild(a);
      });
    };

    // ... (other code remains unchanged)
  </script>
</body>

</html>
